

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Scripting Sculptor 02 - Analysing model fits with SpecAnalysis &mdash; Sculptor 0.4b0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Scripting Sculptor 03 - Fitting and Analzying models using MCMC" href="scripting_sculptor_3.html" />
    <link rel="prev" title="Scripting Sculptor 01 - Modelling the example spectrum in a script" href="scripting_sculptor_1.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Sculptor
          

          
          </a>

          
            
            
              <div class="version">
                0.4b0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">The Sculptor GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="first_fit.html">Spectral fitting with the Sculptor GUI</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="speconed_demonstration.html">An introduction to the SpecOneD class</a></li>
<li class="toctree-l1"><a class="reference internal" href="speconed_demonstration.html#The-PassBand-class">The PassBand class</a></li>
<li class="toctree-l1"><a class="reference internal" href="spectrum_preparation.html">Preparing a composite spectrum for Sculptor modeling using the SpecOneD class</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripting_sculptor_1.html">Scripting Sculptor 01 - Modelling the example spectrum in a script</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Scripting Sculptor 02 - Analysing model fits with SpecAnalysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Analyzing-continuum-properties">Analyzing continuum properties</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Calculating-the-average-continuum-flux-density">Calculating the average continuum flux density</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Calculating-the-monochromatic-continuum-luminosity">Calculating the monochromatic continuum luminosity</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Calculating-the-apparent-monochromatic-AB-magnitude">Calculating the apparent monochromatic AB magnitude</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Calculating-the-absolute-monochromatic-AB-magnitude">Calculating the absolute monochromatic AB magnitude</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Calculate-the-absolute-magnitude-from-the-the-apparent-magnitude">Calculate the absolute magnitude from the the apparent magnitude</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Calculate-the-absolute-magnitude-from-the-monochromatic-luminosity">Calculate the absolute magnitude from the monochromatic luminosity</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id1">Calculate the absolute magnitude from the monochromatic luminosity</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Analyzing-line-properties">Analyzing line properties</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#The-peak-flux-density">The peak flux density</a></li>
<li class="toctree-l3"><a class="reference internal" href="#The-peak-redshift">The peak redshift</a></li>
<li class="toctree-l3"><a class="reference internal" href="#The-line-Full-Width-at-Half-Maximum-(FWHM)">The line Full Width at Half Maximum (FWHM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#The-integrated-line-flux">The integrated line flux</a></li>
<li class="toctree-l3"><a class="reference internal" href="#The-integrated-line-luminosity">The integrated line luminosity</a></li>
<li class="toctree-l3"><a class="reference internal" href="#The-line-equivalent-width-(observed-frame/rest-frame)">The line equivalent width (observed-frame/rest-frame)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Non-parametric-measurements">Non-parametric measurements</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#High-level-SpecAnalysis-routines">High-level SpecAnalysis routines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#SpecAnalysis.analyze_continuum">SpecAnalysis.analyze_continuum</a></li>
<li class="toctree-l3"><a class="reference internal" href="#SpecAnalysis.analyze_emission_feature">SpecAnalysis.analyze_emission_feature</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="scripting_sculptor_3.html">Scripting Sculptor 03 - Fitting and Analzying models using MCMC</a></li>
</ul>
<p class="caption"><span class="caption-text">Module documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="speconed.html">The SpecOneD Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="specmodel.html">The SpecModel Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="specfit.html">The SpecFit Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="specanalysis.html">The SpecAnalysis Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="masksmodels.html">The Masks &amp; Models Module</a></li>
</ul>
<p class="caption"><span class="caption-text">Extensions:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="qso_extension.html">The QSO-Extension Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="my_extension.html">Example extension Module</a></li>
</ul>
<p class="caption"><span class="caption-text">License:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Sculptor</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Scripting Sculptor 02 - Analysing model fits with SpecAnalysis</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/scripting_sculptor_2.nblink.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Scripting-Sculptor-02---Analysing-model-fits-with-SpecAnalysis">
<h1>Scripting Sculptor 02 - Analysing model fits with SpecAnalysis<a class="headerlink" href="#Scripting-Sculptor-02---Analysing-model-fits-with-SpecAnalysis" title="Permalink to this headline">¶</a></h1>
<p>The next step after successfully fitting a model to the astronomical spectrum is the analysis of the model fit. The Sculptor <em>SpecAnalysis</em> module is designed to make this task easy with your Sculptor fit. While fitting a single function (e.g., a Gaussian) to an emission or absorption feature may be easy to analyze, deriving important quantities, such as the width, peak flux or equivalent width from multi-component line fits can be more tedious. Luckily, the <em>SpecAnalysis</em> module includes all of
this functionality already.</p>
<p>However, before we begin, we need to import the most important python packages. We will use numpy and the astropy.units and astropy.cosmology packages as well as the three sculptor modules <em>SpecOneD</em>, <em>SpecFit</em>, and - the topic of this notebook - <em>SpecAnalysis</em>.</p>
<p><strong>DISCLAIMER: At the moment the SpecAnalysis functions are written for model spectra in WAVELENGTH units. If you are working with a science spectrum in FREQUENCY units, please convert all model spectra to wavelength before using the SpecAnalysis functionality.</strong></p>
<p><strong>Note:</strong> A lot of the functionality of the <em>SpecAnalysis</em> module presented here can also be used without using Sculptor to generate your model fits. You only need your model spectrum in a file. Then you can read it in as a <em>SpecOneD</em> object and analyse it using this module.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sculptor</span> <span class="kn">import</span> <span class="n">speconed</span> <span class="k">as</span> <span class="n">scspec</span>
<span class="kn">from</span> <span class="nn">sculptor</span> <span class="kn">import</span> <span class="n">specfit</span> <span class="k">as</span> <span class="n">scfit</span>
<span class="kn">from</span> <span class="nn">sculptor</span> <span class="kn">import</span> <span class="n">specanalysis</span> <span class="k">as</span> <span class="n">scana</span>

<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span>
<span class="kn">from</span> <span class="nn">astropy.cosmology</span> <span class="kn">import</span> <span class="n">FlatLambdaCDM</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[INFO] Import &#34;sculptor_extensions&#34; package: my_extension
[INFO] Import &#34;sculptor_extensions&#34; package: qso
[INFO] SWIRE library found.
[INFO] FeII iron template of Vestergaard &amp; Wilkes 2001 found. If you will be using these templates in your model fit and publication, please add the citation to the original work, ADS bibcode: 2001ApJS..134....1V
[INFO] FeII iron template of Tsuzuki et al. 2006 found. If you will be using these templates in your model fit and publication, please add the citation to the original work, ADS bibcode: 2006ApJ...650...57T
[INFO] FeII iron template of Boroson &amp; Green 1992 found. If you will be using these templates in your model fit and publication, please add the citation to the original work, ADS bibcode: 1992ApJS...80..109B
</pre></div></div>
</div>
<p>As before, importing the SpecFit package prompts a few status messages of Sculptor to appear.</p>
<p>For extragalactic sources it is important to specify the cosmology, to allow derivation of luminosities or absolute magnitudes.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Define Cosmology for cosmological conversions</span>
<span class="n">cosmo</span> <span class="o">=</span> <span class="n">FlatLambdaCDM</span><span class="p">(</span><span class="n">H0</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">Om0</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">Tcmb0</span><span class="o">=</span><span class="mf">2.725</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>In the next step we import the saved Sculptor model fit.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Instantiate an empty SpecFit object</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">scfit</span><span class="o">.</span><span class="n">SpecFit</span><span class="p">()</span>
<span class="c1"># Load the Sculptor model fit from its folder</span>
<span class="n">fit</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;../example_spectrum_fit&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now, we begin with building model spectra (<em>SpecOneD</em> objects) from the models in our fit. To do this you need to know the model prefixes you have chosen to uniquely identify your model functions. It does not matter if the model functions are in separate <em>SpecModel</em> instances in your model fit (<em>SpecFit</em> object) or not. The <em>SpecAnalysis</em> function <em>.build_model_flux</em> will go through all <em>SpecModels</em> to look for them. The first argument of the function will be the <em>SpecFit</em> object and the second
one will be a list of strings denoting the model functions prefixes to choose.</p>
<p>Our goal is to analyze the CIV emission line (model prefixes ‘CIV_A_’, ‘CIV_B_’) and the quasar continuum (‘PL_’). However, to illustrate the point above, we will first build the model spectrum of both continuum and CIV line and display it.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Building the model flux from the CIV emission line and power law continuum model</span>
<span class="c1"># This is done to illustrate how the .build_model_flux function finds model functions</span>
<span class="c1"># independent of their SpecModel association in the SpecFit object.</span>
<span class="n">example_model_spec</span> <span class="o">=</span> <span class="n">scana</span><span class="o">.</span><span class="n">build_model_flux</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;CIV_A_&#39;</span><span class="p">,</span> <span class="s1">&#39;CIV_B_&#39;</span><span class="p">,</span> <span class="s1">&#39;PL_&#39;</span><span class="p">])</span>
<span class="n">example_model_spec</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/scripting_sculptor_2_7_0.png" src="_images/scripting_sculptor_2_7_0.png" />
</div>
</div>
<p>As you can see above the <em>.build_model_flux</em> function used both the power law continuum and the emission line Gaussians from two different <em>SpecModels</em> in the <em>SpecFit</em> object to construct the model spectrum. However, in most cases one would want to choose to analyze the continuum independent of the emission lines. Therefore, we build two model spectra below.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Build the continuum model spectrum</span>
<span class="n">cont_spec</span> <span class="o">=</span> <span class="n">scana</span><span class="o">.</span><span class="n">build_model_flux</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;PL_&#39;</span><span class="p">])</span>
<span class="c1"># Build the CIV emission line model spectrum</span>
<span class="n">civ_spec</span> <span class="o">=</span> <span class="n">scana</span><span class="o">.</span><span class="n">build_model_flux</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;CIV_A_&#39;</span><span class="p">,</span> <span class="s1">&#39;CIV_B_&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p><em>Sculptor</em> offers some very high level functions for the analysis of both continuum and emission line features. However, we will first illustrate below how to derive important properties by hand using the lower level <em>SpecAnalysis</em> functionality.</p>
<div class="section" id="Analyzing-continuum-properties">
<h2>Analyzing continuum properties<a class="headerlink" href="#Analyzing-continuum-properties" title="Permalink to this headline">¶</a></h2>
<p>We begin by analyzing the continuum. In the case of quasar spectroscopy, an important quantity is the flux/luminosity/magnitude at 1450A (rest-frame).</p>
<div class="section" id="Calculating-the-average-continuum-flux-density">
<h3>Calculating the average continuum flux density<a class="headerlink" href="#Calculating-the-average-continuum-flux-density" title="Permalink to this headline">¶</a></h3>
<p>To calculate the flux density at a specific point in the model spectrum we use the <em>SpecAnalysis</em> function <strong>.get_average_fluxden</strong>. It calculates the average flux density of a spectrum (SpecOneD object, first argument) in a window centered at the specified dispersion (second argument) and with a given width (keyword argument, <em>width=10</em> default). The dispersion and the width need to be in the same quantity as the dispersion axis, i.e. the unit in which the dispersion axis is plotted if you
would plot your model spectrum. A redshift keyword argument (<em>redshift=0</em>, default) can be specified, which automatically translates the rest-frame central dispersion value and the rest-frame width to the observed frame.</p>
<p><strong>Note:</strong> <em>Of course you can take your observed spectrum, import it as a SpecOneD object, and calculate the average continuum flux density directly from the science spectrum in regions unaffected by emission or absorption features with this function.</em></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Calculate the average flux density at 1445-1455A rest-frame</span>
<span class="n">fluxden_1450</span> <span class="o">=</span> <span class="n">scana</span><span class="o">.</span><span class="n">get_average_fluxden</span><span class="p">(</span><span class="n">cont_spec</span><span class="p">,</span> <span class="mi">1450</span><span class="p">,</span>
                                         <span class="n">redshift</span><span class="o">=</span><span class="n">fit</span><span class="o">.</span><span class="n">redshift</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average flux density at 1450A: &#39;</span><span class="p">,</span><span class="n">fluxden_1450</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Average flux density at 1450A:  2.2770917934343433e-16 erg / (Angstrom cm2 s)
</pre></div></div>
</div>
<p>Note how the function automatically returns the <strong>physical</strong> value of the flux density <strong>including</strong> the unit. All of the <em>SpecAnalysis</em> functions are designed to work with the astropy.units package to automatically return results with units. This allows for easy conversions into different unit system and for double checking the that the returned values are actually reasonable.</p>
</div>
<div class="section" id="Calculating-the-monochromatic-continuum-luminosity">
<h3>Calculating the monochromatic continuum luminosity<a class="headerlink" href="#Calculating-the-monochromatic-continuum-luminosity" title="Permalink to this headline">¶</a></h3>
<p>In the next step we will convert the average flux density to an average <strong>monochromatic luminosity</strong> using the cosmology (astropy.Cosmology object) defined above.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lum_mono</span> <span class="o">=</span> <span class="n">scana</span><span class="o">.</span><span class="n">calc_lwav_from_fwav</span><span class="p">(</span><span class="n">fluxden_1450</span><span class="p">,</span>
                                     <span class="n">redshift</span><span class="o">=</span><span class="n">fit</span><span class="o">.</span><span class="n">redshift</span><span class="p">,</span>
                                     <span class="n">cosmology</span><span class="o">=</span><span class="n">cosmo</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Monochromatic luminosity at 1450A: &#39;</span><span class="p">,</span> <span class="n">lum_mono</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Monochromatic luminosity at 1450A:  8.864701317998224e+43 erg / (Angstrom s)
</pre></div></div>
</div>
</div>
<div class="section" id="Calculating-the-apparent-monochromatic-AB-magnitude">
<h3>Calculating the apparent monochromatic AB magnitude<a class="headerlink" href="#Calculating-the-apparent-monochromatic-AB-magnitude" title="Permalink to this headline">¶</a></h3>
<p>We calculate the apparent magnitude from the averaged flux density. To do this we use the <em>SpecAnalsysis</em> function <em>calc_apparent_mag_from_fluxden</em>. It takes the averaged flux density as the first argument and the central observed dispersion (wavelength or frequency) of the flux density as arguments. Note that the dispersion value should be a quantity (astropy.Quantity).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">abmag</span> <span class="o">=</span> <span class="n">scana</span><span class="o">.</span><span class="n">calc_apparent_mag_from_fluxden</span><span class="p">(</span>
    <span class="n">fluxden_1450</span><span class="p">,</span>
    <span class="mi">1450</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">fit</span><span class="o">.</span><span class="n">redshift</span><span class="p">)</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">AA</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Apparent AB magnitude at 1450A: &#39;</span><span class="p">,</span> <span class="n">abmag</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Apparent AB magnitude at 1450A:  17.761599161710915 mag
</pre></div></div>
</div>
</div>
<div class="section" id="Calculating-the-absolute-monochromatic-AB-magnitude">
<h3>Calculating the absolute monochromatic AB magnitude<a class="headerlink" href="#Calculating-the-absolute-monochromatic-AB-magnitude" title="Permalink to this headline">¶</a></h3>
<p>From here we can calculate the sources AB magnitude at 1450A in three different ways: 1. Calculate the absolute magnitude from the the apparent magnitude 2. Calculate the absolute magnitude from the flux density 3. Calculate the absolute magnitude from the monochromatic luminosity</p>
<p>Let’s briefly go through all three possibilities.</p>
<div class="section" id="Calculate-the-absolute-magnitude-from-the-the-apparent-magnitude">
<h4>Calculate the absolute magnitude from the the apparent magnitude<a class="headerlink" href="#Calculate-the-absolute-magnitude-from-the-the-apparent-magnitude" title="Permalink to this headline">¶</a></h4>
<p>We calculated the apparent magnitude above. Now we only need to convert it to the absolute magnitude. In this step we need to specify the cosmology as well as to indicate how the flux should be corrected due to the change of the filter bandpass - the K-correction. For monochromatic magnitudes this is simply a scaling factor of (1+z) in flux.</p>
<p>We use the <em>SpecAnalysis</em> function <em>calc_absolute_mag_from_apparent_mag</em>, which takes the apparent magnitude as the first argument, the cosmology (astropy.Cosmology) as the second argument and the redshift as the third argument. At present the function only allows to add the kcorrection for spectra with a power-law type continuum (power law index <em>a_nu</em>).</p>
<p><strong>Note:</strong>In the case of monochromatic magnitudes, the K-correction is specified by setting the <em>kcorrection</em> keyword argument to <em>True</em> and the power law slope to <em>a_nu=0</em>, independent of the source’s continuum shape. (Incidentally these are the default values.)</p>
<p>(For apparent to absolute magnitude conversions for bandpass magnitudes and non-power law continua, you can still use this function setting <em>kcorrection=False</em> and then apply the appropriate K-correction factor in magnitudes yourself.)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">abs_abmag</span> <span class="o">=</span> <span class="n">scana</span><span class="o">.</span><span class="n">calc_absolute_mag_from_apparent_mag</span><span class="p">(</span><span class="n">abmag</span><span class="p">,</span> <span class="n">cosmo</span><span class="p">,</span>
                                                   <span class="n">fit</span><span class="o">.</span><span class="n">redshift</span><span class="p">,</span>
                                                   <span class="n">kcorrection</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                   <span class="n">a_nu</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Absolute magnitude at 1450 (from apparent magnitude): &#39;</span><span class="p">,</span> <span class="n">abs_abmag</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Absolute magnitude at 1450 (from apparent magnitude):  -27.889171135994392 mag
</pre></div></div>
</div>
</div>
<div class="section" id="Calculate-the-absolute-magnitude-from-the-monochromatic-luminosity">
<h4>Calculate the absolute magnitude from the monochromatic luminosity<a class="headerlink" href="#Calculate-the-absolute-magnitude-from-the-monochromatic-luminosity" title="Permalink to this headline">¶</a></h4>
<p>We do not need to calculate the apparent monochromatic magnitude to get to the absolute monochromatic magnitude. We can directly compute this from the flux density at 1450A using the <em>SpecAnalysis.calc_absolute_mag_from_fluxden</em> function.</p>
<p>However, the function goes through the same steps as we did above. Therefore, we also need to specify the K-correction and power law slope keywords on top of the monochromatic flux density (first argument), the observed dispersion (second argument), the cosmology (third argument), and the redshift (fourth argument).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">abs_abmag2</span> <span class="o">=</span> <span class="n">scana</span><span class="o">.</span><span class="n">calc_absolute_mag_from_fluxden</span><span class="p">(</span>
    <span class="n">fluxden_1450</span><span class="p">,</span> <span class="mi">1450</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">fit</span><span class="o">.</span><span class="n">redshift</span><span class="p">)</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">AA</span><span class="p">,</span>
    <span class="n">cosmo</span><span class="p">,</span> <span class="n">fit</span><span class="o">.</span><span class="n">redshift</span><span class="p">,</span> <span class="n">kcorrection</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">a_nu</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Absolute magnitude at 1450 (from monochr. flux density): &#39;</span><span class="p">,</span> <span class="n">abs_abmag2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Absolute magnitude at 1450 (from monochr. flux density):  -27.889171135994392 mag
</pre></div></div>
</div>
</div>
<div class="section" id="id1">
<h4>Calculate the absolute magnitude from the monochromatic luminosity<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>We already calculated the monochromatic luminosity above. Of course we can directly calculate the absolute magnitude from the monochromatic luminosity. In the <em>SpecAnalysis</em> module the function <em>calc_absolute_mag_from_monochromatic_luminosity</em> does that for you. You specify the monochromatic luminosity and the corresponding <strong>rest-frame wavelength</strong> value as the first and second arguments. The cosmological corrections were already applied, when calculating the monochromatic luminosity above.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">abs_abmag3</span> <span class="o">=</span> <span class="n">scana</span><span class="o">.</span><span class="n">calc_absolute_mag_from_monochromatic_luminosity</span><span class="p">(</span><span class="n">lum_mono</span><span class="p">,</span> <span class="mi">1450</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">AA</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Absolute magnitude at 1450 (from monochr. luminosity): &#39;</span><span class="p">,</span> <span class="n">abs_abmag3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Absolute magnitude at 1450 (from monochr. luminosity):  -27.88917113599439 mag
</pre></div></div>
</div>
<p>As you can see all three functions to calculate the absolute magnitude lead to the same value of ~-27.9 mag.</p>
</div>
</div>
</div>
<div class="section" id="Analyzing-line-properties">
<h2>Analyzing line properties<a class="headerlink" href="#Analyzing-line-properties" title="Permalink to this headline">¶</a></h2>
<p>We now turn to calculate line properties. In our example, we will focus on the CIV emission line of the example quasar spectrum. We modeled the CIV line with two Gaussian components and stored the model flux in a <em>SpecOneD</em> object, called civ_spec. Let’s first check if the model flux looks reasonable.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Plot the CIV model flux spectrum, adjusting the y-axis limits</span>
<span class="n">civ_spec</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/scripting_sculptor_2_23_0.png" src="_images/scripting_sculptor_2_23_0.png" />
</div>
</div>
<p>The model flux specturm look reasonable, so we can continue!</p>
<div class="section" id="The-peak-flux-density">
<h3>The peak flux density<a class="headerlink" href="#The-peak-flux-density" title="Permalink to this headline">¶</a></h3>
<p>In order to calculate the peak flux density, we can rely on the <em>numpy</em> package:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">civ_peak_fluxden</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">civ_spec</span><span class="o">.</span><span class="n">fluxden</span><span class="p">)</span><span class="o">*</span><span class="n">civ_spec</span><span class="o">.</span><span class="n">fluxden_unit</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CIV peak flux density: </span><span class="si">{:.2e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">civ_peak_fluxden</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CIV peak flux density: 1.69e-16 erg / (Angstrom cm2 s)
</pre></div></div>
</div>
</div>
<div class="section" id="The-peak-redshift">
<h3>The peak redshift<a class="headerlink" href="#The-peak-redshift" title="Permalink to this headline">¶</a></h3>
<p>Although this calculation is quite simply, we have decided to add this functionality to the <em>SpecAnalysis</em> module with the <em>get_peak_redshift</em> function. It requires the line model spectrum and the rest-frame wavelength of the feature.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">civ_z</span> <span class="o">=</span> <span class="n">scana</span><span class="o">.</span><span class="n">get_peak_redshift</span><span class="p">(</span><span class="n">civ_spec</span><span class="p">,</span> <span class="mf">1549.06</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CIV peak redshift: </span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">civ_z</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CIV peak redshift: 3.210
</pre></div></div>
</div>
</div>
<div class="section" id="The-line-Full-Width-at-Half-Maximum-(FWHM)">
<h3>The line Full Width at Half Maximum (FWHM)<a class="headerlink" href="#The-line-Full-Width-at-Half-Maximum-(FWHM)" title="Permalink to this headline">¶</a></h3>
<p>For line models with a single Gaussian component, the FWHM can be directly retrieved from the model function. However, for composite lines it is more difficult to define and then calculate a FWHM. The <em>SpecAnalysis</em> implementation for calculating the FWHM <strong>get_fwhm</strong>, follows the simplest definition of the FWHM:</p>
<p>It calculates the peak flux density and then sets up a spline interpolation subtracting half of the peak flux density from the model spectrum. If the line model flux is well defined the resulting spline should have exactly two roots (model flux = 0). The function returns the dispersion difference between the two roots. If the line feature has multiple components more or less than two roots can be found in which case a np.NaN value will be returned.</p>
<p><strong>Correction for spectral resolution:</strong> The keyword argument <em>resolution</em> allows to specify the spectral resolution in R = Lambda/Delta Lambda. If the <em>resolution</em> value is not <em>None</em>, the spectral resolution will be subtracted from the FWHM of the line feature (assuming FWHM_corr^2 = FWHM^2 - Resolution_km_s^2). If you specify the resolution, an info message will let you know that the function has corrected the FWHM for it.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Calculate the CIV FWHM</span>
<span class="n">civ_fwhm</span> <span class="o">=</span> <span class="n">scana</span><span class="o">.</span><span class="n">get_fwhm</span><span class="p">(</span><span class="n">civ_spec</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CIV FWHM: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">civ_fwhm</span><span class="p">))</span>

<span class="c1"># Calculate the CIV FWHM, taking into account a spectral resolution of R=1000</span>
<span class="n">civ_fwhm</span> <span class="o">=</span> <span class="n">scana</span><span class="o">.</span><span class="n">get_fwhm</span><span class="p">(</span><span class="n">civ_spec</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CIV FWHM (accounting for spectral resolution): </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">civ_fwhm</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CIV FWHM: 6351.97 km / s
[INFO] FWHM is corrected for the provided resolution of R=1000
CIV FWHM (accounting for spectral resolution): 6344.89 km / s
</pre></div></div>
</div>
<p>Additionally, there are two different methods for calculating the FWHM from the model spectrum. The default method ‘spline’ uses a spline to interpolate the original spectrum and find the zero points using a root finding algorithm on the spline. The second method ‘sign’ finds sign changes in the half peak flux subtracted spectrum. Their results may differ depending on the dispersion resolution. From an initial test it seems that the computational cost of both methods is similar.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">civ_fwhm</span> <span class="o">=</span> <span class="n">scana</span><span class="o">.</span><span class="n">get_fwhm</span><span class="p">(</span><span class="n">civ_spec</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CIV FWHM (&quot;sign&quot; method): </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">civ_fwhm</span><span class="p">))</span>

<span class="n">civ_fwhm</span> <span class="o">=</span> <span class="n">scana</span><span class="o">.</span><span class="n">get_fwhm</span><span class="p">(</span><span class="n">civ_spec</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;sign&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CIV FWHM (&quot;spline&quot; method): </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">civ_fwhm</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CIV FWHM (&#34;sign&#34; method): 6351.97 km / s
CIV FWHM (&#34;spline&#34; method): 6350.92 km / s
</pre></div></div>
</div>
</div>
<div class="section" id="The-integrated-line-flux">
<h3>The integrated line flux<a class="headerlink" href="#The-integrated-line-flux" title="Permalink to this headline">¶</a></h3>
<p>The integrated line flux is easily calculated by the <em>get_integrated_flux</em> function of the <em>SpecAnalysis</em> module. By default the line model spectrum will be integrated over its full length. However, you can specify the <em>disp_range</em> keyword argument, setting the integration boundaries in units of the dispersion axis manually.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">civ_flux</span> <span class="o">=</span> <span class="n">scana</span><span class="o">.</span><span class="n">get_integrated_flux</span><span class="p">(</span><span class="n">civ_spec</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CIV integrated flux: </span><span class="si">{:.2e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">civ_flux</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CIV integrated flux: 2.97e-14 erg / (cm2 s)
</pre></div></div>
</div>
</div>
<div class="section" id="The-integrated-line-luminosity">
<h3>The integrated line luminosity<a class="headerlink" href="#The-integrated-line-luminosity" title="Permalink to this headline">¶</a></h3>
<p>In a similar fashion you can calculate the integrated line luminosity. In addition to the line model spectrum, the function takes the source redshift and the cosmology as the second and third argument.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">civ_line_lum</span> <span class="o">=</span> <span class="n">scana</span><span class="o">.</span><span class="n">calc_integrated_luminosity</span><span class="p">(</span><span class="n">civ_spec</span><span class="p">,</span>
                                                <span class="n">fit</span><span class="o">.</span><span class="n">redshift</span><span class="p">,</span>
                                                <span class="n">cosmo</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CIV integrated line luminosity: </span><span class="si">{:.2e}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">civ_line_lum</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CIV integrated line luminosity: 2.74e+45 erg / s
</pre></div></div>
</div>
</div>
<div class="section" id="The-line-equivalent-width-(observed-frame/rest-frame)">
<h3>The line equivalent width (observed-frame/rest-frame)<a class="headerlink" href="#The-line-equivalent-width-(observed-frame/rest-frame)" title="Permalink to this headline">¶</a></h3>
<p>An important property of an emission or absorption feature is its equivalent width. For this calculation we need both the continuum model flux (cont_spec) and the line model flux (civ_spec). In order to calculate the rest-frame equivalent width for extragalactic sources the <em>redshift</em> keyword also needs to be specified. In the <em>SpecAnalysis</em> module the <em>get_equivalent_width</em> function calculates the equivalent width. For our example we use the CIV redshift that we determined above in this
calculation. If we don’t specify the redshift, the function returns the observed-frame equivalent width.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Calculate the rest-frame equivalent width</span>
<span class="n">civ_ew</span> <span class="o">=</span> <span class="n">scana</span><span class="o">.</span><span class="n">get_equivalent_width</span><span class="p">(</span><span class="n">cont_spec</span><span class="p">,</span> <span class="n">civ_spec</span><span class="p">,</span> <span class="n">redshift</span><span class="o">=</span><span class="n">civ_z</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CIV EW (rest-frame): </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">civ_ew</span><span class="p">))</span>

<span class="c1"># Calculate the observed-frame equivalent width</span>
<span class="n">civ_ew</span> <span class="o">=</span> <span class="n">scana</span><span class="o">.</span><span class="n">get_equivalent_width</span><span class="p">(</span><span class="n">cont_spec</span><span class="p">,</span> <span class="n">civ_spec</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CIV EW (observed-frame): </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">civ_ew</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CIV EW (rest-frame): 33.38 Angstrom
CIV EW (observed-frame): 140.51 Angstrom
</pre></div></div>
</div>
</div>
<div class="section" id="Non-parametric-measurements">
<h3>Non-parametric measurements<a class="headerlink" href="#Non-parametric-measurements" title="Permalink to this headline">¶</a></h3>
<p>Furthermore we provide a range of non-parametric measurements for emission line features. These are measurements of the fraction of cumulative flux in velocity space. The redshift and rest-frame wavelength of the emission line define the velocity zero point. Negative velocities indicate flux blueward of the line and positive velocities indicate flux redward of the line.</p>
<p>In the current implementation the velocities at 5%, 10%, 50%, 90% and 95% of the cumulative flux fraction are calculated. The calculation also returns the mean resolution at 50% of the cumulative flux fraction as an indication for the uncertainty introduced by the spectral resolution.</p>
<p>From the median velocity (velocity at 50% of the cumulative flux fraction) we can derive its frequency, wavelength and redshift, which are all included in this analysis function.</p>
<p>The dispersion range keyword argument can be used to supply the physical dispersion limits in which the analysis should be executed.</p>
<p><strong>The non-parametric measurements are NOT included in the default line measurements (scana.emfeat_measures_default) for the high-level analysis function (see below). Specifically for the analysis of resampled results or MCMC chains the non-parametric measurements are more computationally expensive.</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Use the emission feature analysis function to analyze the CIV line</span>
<span class="n">civ_result</span> <span class="o">=</span> <span class="n">scana</span><span class="o">.</span><span class="n">analyze_emission_feature</span><span class="p">(</span>
    <span class="n">fit</span><span class="p">,</span> <span class="s1">&#39;CIV&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;CIV_A_&#39;</span><span class="p">,</span> <span class="s1">&#39;CIV_B_&#39;</span><span class="p">],</span> <span class="mf">1549.06</span><span class="p">,</span> <span class="n">cont_model_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;PL_&#39;</span><span class="p">],</span>
    <span class="n">redshift</span><span class="o">=</span><span class="n">fit</span><span class="o">.</span><span class="n">redshift</span><span class="p">,</span> <span class="n">emfeat_meas</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nonparam&#39;</span><span class="p">],</span> <span class="n">cosmology</span><span class="o">=</span><span class="n">cosmo</span><span class="p">)</span>

<span class="c1"># Print the results from the dictionary</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">civ_result</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> = </span><span class="si">{:.2e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">civ_result</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CIV_v50 = -1.24e+03 km / s
CIV_v05 = -8.37e+03 km / s
CIV_v10 = -6.35e+03 km / s
CIV_v90 = 3.89e+03 km / s
CIV_v95 = 5.92e+03 km / s
CIV_vres_at_line = 6.88e+01 km / s
CIV_freq_v50 = 4.60e+14 Hz
CIV_wave_v50 = 6.52e+03 Angstrom
CIV_redsh_v50 = 3.21e+00
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="High-level-SpecAnalysis-routines">
<h2>High-level SpecAnalysis routines<a class="headerlink" href="#High-level-SpecAnalysis-routines" title="Permalink to this headline">¶</a></h2>
<p>We have written high-level <em>SpecAnalysis</em> routines that automatically calculate a range of continuum and line properties for you using the functions described above.</p>
<div class="section" id="SpecAnalysis.analyze_continuum">
<h3>SpecAnalysis.analyze_continuum<a class="headerlink" href="#SpecAnalysis.analyze_continuum" title="Permalink to this headline">¶</a></h3>
<p>The <em>analyze_continuum</em> routine allows for automatic continuum analysis. It takes four important arguments: * the SpecFit object * a list of model prefix names that make up the continuum model * a list of rest-frame wavelengths (float) for which fluxes, luminosities and magnitudes should be calculated * the cosmology (astropy.Cosmology)</p>
<p>The most important keyword argument is <em>cont_meas</em>, which stands for continuum measurements. The full list of continuum measurements available in the SpecAnalysis module is:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">scana</span><span class="o">.</span><span class="n">cont_measures_default</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;fluxden_avg&#39;, &#39;Lwav&#39;, &#39;appmag&#39;, &#39;absmag&#39;]
</pre></div></div>
</div>
<p>By default all of these will be calculated. For the full list of keyword arguments, please directly consult the documentation.</p>
<p>The function returns a dictionary with the results.</p>
<p>In the following example, we will analyze the continuum of the example spectrum at rest-frame wavelengths of 1450A (as above) and 1280A.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Define Cosmology for cosmological conversions</span>
<span class="n">cosmo</span> <span class="o">=</span> <span class="n">FlatLambdaCDM</span><span class="p">(</span><span class="n">H0</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">Om0</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">Tcmb0</span><span class="o">=</span><span class="mf">2.725</span><span class="p">)</span>

<span class="c1"># Import the saved example spectrum</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">scfit</span><span class="o">.</span><span class="n">SpecFit</span><span class="p">()</span>
<span class="n">fit</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;../example_spectrum_fit&#39;</span><span class="p">)</span>

<span class="c1"># Use the continuum analysis function</span>
<span class="n">cont_result</span> <span class="o">=</span> <span class="n">scana</span><span class="o">.</span><span class="n">analyze_continuum</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;PL_&#39;</span><span class="p">],</span>
                                      <span class="p">[</span><span class="mi">1450</span><span class="p">,</span> <span class="mi">1280</span><span class="p">],</span>
                                      <span class="n">cosmo</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Print the results from the dictionary</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cont_result</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> = </span><span class="si">{:.2e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">cont_result</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1450_fluxden_avg = 2.28e-16 erg / (Angstrom cm2 s)
1450_Lwav = 8.86e+43 erg / (Angstrom s)
1450_appmag = 1.78e+01 mag
1450_absmag = -2.79e+01 mag
1280_fluxden_avg = 2.64e-16 erg / (Angstrom cm2 s)
1280_Lwav = 1.03e+44 erg / (Angstrom s)
1280_appmag = 1.79e+01 mag
1280_absmag = -2.78e+01 mag
</pre></div></div>
</div>
</div>
<div class="section" id="SpecAnalysis.analyze_emission_feature">
<h3>SpecAnalysis.analyze_emission_feature<a class="headerlink" href="#SpecAnalysis.analyze_emission_feature" title="Permalink to this headline">¶</a></h3>
<p><strong>Disclaimer</strong>:At this point we have only implemented an automatic high-level analysis for emission features. A more general function for both absorption and emission lines or, alternatively, a separate function for absorption lines is on our To-Do list.</p>
<p>In similar fashion to the <em>analyze_continuum</em> function above, <em>analyze_emission_feature</em> takes four important arguments: * the SpecFit object * the name of the emission feature, which will be used to name the resulting measurements in the output dictionary * a list of model names to create the emission feature flux from * the rest-frame wavelength of the emission feature</p>
<p>The cosmology is a keyword argument for this function (<em>cosmology</em>, astropy.Cosmology). Another important keyword argument is <em>emfeat_meas</em>, which stands for emission feature measurements and is a list of strings. The full list of possible emission feature measurements (and the default value) is:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">scana</span><span class="o">.</span><span class="n">emfeat_measures_default</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;peak_fluxden&#39;, &#39;peak_redsh&#39;, &#39;EW&#39;, &#39;FWHM&#39;, &#39;flux&#39;, &#39;lum&#39;]
</pre></div></div>
</div>
<p>For a full list of all available keyword arguments, please directly consult the documentation of the <em>SpecAnalysis</em> module.</p>
<p>In the following example we will repeat our analysis of the CIV line from above. Note, that in order to calculate the equvialent width we also need to specify the cont_model_names to generate the continuum model flux.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Use the emission feature analysis function to analyze the CIV line</span>
<span class="n">civ_result</span> <span class="o">=</span> <span class="n">scana</span><span class="o">.</span><span class="n">analyze_emission_feature</span><span class="p">(</span>
    <span class="n">fit</span><span class="p">,</span> <span class="s1">&#39;CIV&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;CIV_A_&#39;</span><span class="p">,</span> <span class="s1">&#39;CIV_B_&#39;</span><span class="p">],</span> <span class="mf">1549.06</span><span class="p">,</span> <span class="n">cont_model_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;PL_&#39;</span><span class="p">],</span>
    <span class="n">redshift</span><span class="o">=</span><span class="n">fit</span><span class="o">.</span><span class="n">redshift</span><span class="p">,</span> <span class="n">emfeat_meas</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cosmology</span><span class="o">=</span><span class="n">cosmo</span><span class="p">)</span>

<span class="c1"># Print the results from the dictionary</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">civ_result</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> = </span><span class="si">{:.2e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">civ_result</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CIV_peak_fluxden = 1.69e-16 erg / (Angstrom cm2 s)
CIV_peak_redsh = 3.21e+00
CIV_EW = 3.32e+01 Angstrom
CIV_FWHM = 6.35e+03 km / s
CIV_flux = 2.97e-14 erg / (cm2 s)
CIV_lum = 2.74e+45 erg / s
</pre></div></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="scripting_sculptor_3.html" class="btn btn-neutral float-right" title="Scripting Sculptor 03 - Fitting and Analzying models using MCMC" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="scripting_sculptor_1.html" class="btn btn-neutral float-left" title="Scripting Sculptor 01 - Modelling the example spectrum in a script" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Jan-Torge Schindler.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>